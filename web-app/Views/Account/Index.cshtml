@using System.Globalization;
@model web_server.Models.User
@{
    ViewData["role"] = Model.Role;
    Layout = "_Layout";


}

<script>
    var url = "@web_app.Program.web_server_ip" + "/chatHub" + "?" + "token=" + "@ViewData["userid"]";
    const connection = new signalR.HubConnectionBuilder()
        .configureLogging(signalR.LogLevel.Debug)
        .withUrl(url)
        .configureLogging(signalR.LogLevel.Information)
        .build();
    connection.start().then(() => {
    });

    function submitt(el){

        console.log(el.value);
        if (el.value.includes('.jpg') || el.value.includes('.JPG') || el.value.includes('.png') || el.value.includes('.PNG') || el.value.includes('.jpeg') || el.value.includes('.JPEG')) {
            document.getElementById('submitError').hidden = 'hidden';

            document.getElementById('form').submit();
        }
        else
        {
            document.getElementById('submitError').removeAttribute('hidden');
        }
    }
</script>

<form class="col-xs-12" id="form" method="post" action="@web_app.Program.web_server_ip/api/account/savephoto?id=@Model.UserId" enctype="multipart/form-data">
    <br/>
    <label>Фотография</label>
    <br />
        <br/>
    <img width="50" height="50" src="@Model.PhotoUrl"/>

    <br />
    <label hidden="hidden" id="submitError" style="color:darkred">Доступные форматы файла: jpg, png, jpeg</label>
    <br />
    <br />
    <div class="form-group">
        <input type="file" onchange="submitt(this)" class="form-control" id="photoId" name="image" />
    </div>
  
</form>
<br/>
<script>
    $(document).ready(function () {
        var birthDate = '@Model.BirthDate.ToString("yyyy-MM-dd")';
        $('#BirthDate').val(birthDate);
    });
</script>
<form method="post" action="/account/saveinfo">

    @Html.TextBoxFor(m => m.UserId, new { @class = "form-control txtbox", @hidden="hidden" })
    @Html.TextBoxFor(m => m.ActiveToken, new { @class = "form-control txtbox", @hidden="hidden" })

    @Html.TextBoxFor(m => m.Role, new { @class = "form-control txtbox", @hidden="hidden" })

    <label>Имя</label>
    @Html.TextBoxFor(m => m.FirstName, new { @class = "form-control txtbox" })
    <br />
    <br />

    <label>Фамилия</label>
    @Html.TextBoxFor(m => m.LastName, new { @class = "form-control txtbox" })
    <br />
    <br />

    
    @Html.TextBoxFor(m => m.PhotoUrl, new { @class = "form-control txtbox", @hidden="hidden" })
    <br />
        <br />

    <label>Дата рождения</label>
    @Html.TextBoxFor(m => m.BirthDate, new { @class = "form-control txtbox", @type="date", @id="BirthDate", @min="1920-01-01", @max="2050-12-31" })

    <br />
    <br />

    <label>Почта</label>
    @Html.TextBoxFor(m => m.Email, new { @class = "form-control txtbox" })
    <br />
    <br />

    <label>Пароль</label>
    @Html.TextBoxFor(m => m.Password, new { @class = "form-control txtbox" })
    <br />
    <br />

    <label>Номер телефона</label>
    @Html.TextBoxFor(m => m.Phone, new { @class = "form-control txtbox" })
    <br />
    <br />

    @{
         var w_days = new List<DayOfWeek>()
                                {
                                    DayOfWeek.Monday, DayOfWeek.Tuesday, DayOfWeek.Wednesday, DayOfWeek.Thursday, DayOfWeek.Friday, DayOfWeek.Saturday, DayOfWeek.Sunday
                                };
        if(Model.Role == "Tutor")
        {

          <label>Курсы:</label>
          <br/>
            foreach (var item in Model.Courses)
            {
                <label>@item.Title</label>
                <br />

            }
            <br />
            <br />
            <label>Свободное время по МСК</label>
            <br/>
            <br />
            <table border="1">
            @{
             foreach (var day in w_days)
                {
                <tr>
                <td>
                <label>@DateTimeFormatInfo.CurrentInfo.GetDayName(day)</label>
                </td>
                            @{
                                Model.UserDates.dateTimes = Model.UserDates.dateTimes.OrderBy(m => m.TimeOfDay).ToList();
                                foreach (var time in Model.UserDates.dateTimes)
                                {
                                if (time.DayOfWeek == day)
                                {
                                        <td><label> @time.ToString("HH:mm") </label></td>



                                }
                }
                }
                
              
                </tr>
                //<br />
                //<br />

               

                }
            }
               
            </table>
          

            <br />

            <label>О себе:</label>
            <br/>
            @Html.TextAreaFor(m => m.About, new { @class = "form-control rich-textbox" })
        }
        else if (Model.Role == "Student")
        {
            <label>Пожелания</label>
            @Html.TextAreaFor(m => m.Wish, new { @class = "form-control rich-textbox" })
        }
    }

    <br/>
    <br />
    <input type="submit" value="Сохранить"/>
</form>
@{
    if(ViewData["error"] != null)
    {
        <script>alert(@ViewData["error"].ToString())</script>
    }
}
<a href="/account/logout">выйти</a>
